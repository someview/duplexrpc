
# 通信协议
1. 当前IM系统主要存在四种不同形式的协议，五种不同的框架实现
- 基于gnet的wsserver, 用于app长连接
- 基于grpc的stream客户端
- 字节kitex, 同步的grpc客户端以及grpc服务端,跨集群
- route gorilla/websocket, 用于和websocket客户端和服务端通信
- route mesh协议, 用于对等节点之间通信, 纯tcp实现


# 问题
- 链路追踪
```  
和业务消息耦合，必须把传递的链路追踪的消息和业务消息相互耦合
当前采用的形式是把traceInfo和业务消息一起传递
```
-  当前IM系统设计,整体均是oneway模式, 非req->res模式
```
grpc的bidistream、unistream可以模拟出类似的oneway通信效果，bidistream
```
- route的ws协议存在效率问题, 而route peer之间同步pub消息也没有批量发送或者多路复用

总的来说,我们需要的是一个搞笑的双向传输通道,并在某些时候需要req -> res模式
(route peer之间同步订阅消息)
# 解决方案
## unistream
- 使用双向的unistream来替代掉bidistream，也会让程序变得复杂，
  需要手动管理连接,链路追踪也是问题
## 网络库 + 自定义协议
### 字节netpoll
```
```





   