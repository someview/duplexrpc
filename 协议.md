
## im系统通信协议现状
1. 当前IM系统主要存在四种不同形式的协议，五种不同的框架实现
- 基于gnet的wsserver, 用于app长连接
- 基于grpc的stream客户端
- 字节kitex, 同步的grpc客户端以及grpc服务端,跨集群
- route gorilla/websocket, 用于和websocket客户端和服务端通信
- route mesh协议, 用于对等节点之间通信, 纯tcp实现


## 问题
- 链路追踪
```  
和业务消息耦合，必须把传递的链路追踪的消息和业务消息相互耦合
当前采用的形式是把traceInfo和业务消息一起传递
```
-  当前IM系统设计,整体均是oneway模式, 非req->res模式
```
grpc的bidistream、unistream可以模拟出类似的oneway通信效果，bidistream
```
- route的ws协议存在效率问题, 而route peer之间同步pub消息也没有批量发送或者多路复用

## 需求
总的来说,我们需要的是一个高效的rpc框架，能够支持oneway、双向call、 有状态的state enpoint的调用(route 需要server主动call client在的节点)


## 实现
核心 : 协议
### 客户端功能
服务发现、负载均衡、重试策略、资源控制、 高效io、中间件功能
### 服务端功能
资源控制、服务注册、节点enpoint管理、中间件功能
### 其他特征
- 支持broadcast oneway类型的消息
- 支持 rpc endpoint的管理
- 支持双向call, server端也可以主动call客户端的消息








   